<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.korbiztech.product.cocs.CM.OR.dao.ORB060_DAO">

    <select id="selectSite" resultType="HashMap">
        SELECT A.SITE_CODE,
            '(' || A.SITE_CODE || ') ' || A.SITE_NAME AS SITE_NAME,
            A.SITE_COMMYN,
            MAX(INFO_CHSU) CFM_CHSU
        FROM TCT_SITE A, TBG_INFO B
        WHERE A.SITE_OFFICE = '01'
        AND A.SITE_USEYN = '1'
        AND B.INFO_COMP(+) = '1'
        AND A.SITE_OFFICE = B.INFO_OFFICE(+)
        AND A.SITE_CODE = B.INFO_SITE(+)
        AND SITE_CODE IN (
            SELECT AVBUJ_CD FROM SYTB0110
            WHERE USERS_ID = 'admin'
            AND GUNHA_EQ = '1'
            UNION ALL
            SELECT SITE_CODE FROM TCT_SITE
            WHERE EXISTS (SELECT 1 FROM SYTB0110
                WHERE USERS_ID = 'admin'
                AND GUNHA_EQ = '1'
                AND AVBUJ_CD = '*****')
            )
        GROUP BY A.SITE_CODE, A.SITE_NAME, A.SITE_COMMYN
    </select>

    <select id="selectGrid" parameterType="HashMap" resultType="HashMap">
        SELECT A.ORDR_OFFICE, A.ORDR_SITE, A.ORDR_BNO, A.ORDR_NAME, A.ORDR_SDATE, A.ORDR_MRATE
        , A.ORDR_EDATE, A.ORDR_PDATE, A.ORDR_STIME, A.ORDR_SPLACE, A.ORDR_SMAN
        , A.ORDR_IMAN, A.ORDR_HYTEL, A.ORDR_BIDDATE, A.ORDR_BIDTIME, A.ORDR_DEPT, NVL(A.ORDR_EMP, '0') ORDR_EMP
        , NVL(A.ORDR_RET, '0') ORDR_RET, A.ORDR_CHOICE, A.ORDR_DPRATE, A.ORDR_DCNT, A.ORDR_DCASH
        , A.ORDR_DBILL, A.ORDR_DCRATE, A.ORDR_DHRATE, A.ORDR_DHMONTH, A.ORDR_DJRATE
        , A.ORDR_HPRATE, A.ORDR_HCNT, A.ORDR_HCASH, A.ORDR_HBILL, A.ORDR_HCRATE,A.ORDR_DOAMT, A.ORDR_SIAMT,A.ORDR_DOAMT2, A.ORDR_SIAMT2
        , A.ORDR_HHRATE, A.ORDR_HHMONTH, A.ORDR_HJRATE, A.ORDR_REM, A.ORDR_APPFILE, A.ORDR_FILEPATH, A.ORDR_MAT
        , SUBSTR(A.ORDR_RCODE, 0, 1) ORDR_RCODE_C, ORDR_RCODE, ORDR_GONG, SUBSTR(A.ORDR_GONG, 0, 1) ORDR_GGONG
        , (SELECT NVL(SUM(ORDL_DAMT), 0) FROM TOR_ORDL WHERE ORDL_OFFICE = A.ORDR_OFFICE AND ORDL_SITE = A.ORDR_SITE AND ORDL_BNO = A.ORDR_BNO ) ORDL_DAMT
        , (SELECT NVL(SUM(ORDL_SAMT), 0) FROM TOR_ORDL WHERE ORDL_OFFICE = A.ORDR_OFFICE AND ORDL_SITE = A.ORDR_SITE AND ORDL_BNO = A.ORDR_BNO ) ORDL_SAMT
        , NVL(APP_REPORTER_ID, '') APP_REPORTER_ID, NVL(APP_REPORT_NUM, '') APP_REPORT_NUM, NVL(APP_STAT, '0') APP_STAT
        , A.ORDR_BIDMETH, A.ORDR_BIDGU
        , (SELECT COUNT(*) FROM TOR_ORDL WHERE ORDL_OFFICE = A.ORDR_OFFICE AND ORDL_SITE = A.ORDR_SITE AND ORDL_BNO = A.ORDR_BNO) ORDL_COUNT
        , (SELECT COUNT(*) FROM TOR_CALL WHERE CALL_OFFICE = A.ORDR_OFFICE AND CALL_SITE = A.ORDR_SITE AND CALL_BNO = A.ORDR_BNO) CALL_COUNT, ORDR_STATE
        , A.ORDR_SARATE,A.ORDR_GORATE,A.ORDR_GURATE,A.ORDR_YURATE,A.ORDR_ANRATE,A.ORDR_TJRATE,A.ORDR_MARATE, NVL(A.ORDR_JGBN, '0') ORDR_JGBN
        , A.ORDR_BID_FDATE1, A.ORDR_BID_FTIME1, A.ORDR_BID_TDATE1, A.ORDR_BID_TTIME1, A.ORDR_BID_FDATE2, A.ORDR_BID_FTIME2, A.ORDR_BID_TDATE2, A.ORDR_BID_TTIME2
        , A.ORDR_BID_FDATE3, A.ORDR_BID_FTIME3, A.ORDR_BID_TDATE3, A.ORDR_BID_TTIME3
        , A.ORDR_EQUSR, A.ORDR_EQUSRID, A.ORDR_EQTL, A.ORDR_RBNO
        FROM TOR_ORDR A, TEMP_APPR B
        WHERE
        A.ORDR_OFFICE = '01'
        AND A.ORDR_SITE = #{SITE}
        <!-- AND A.ORDR_BNO = #{ORDRBNO} -->
        <!-- AND A.ORDR_NAME LIKE '%' || #{ORDRNAME} || '%' -->
        AND A.ORDR_RCODE = APP_NO(+)
        ORDER BY A.ORDR_OFFICE DESC , A.ORDR_SITE DESC , A.ORDR_BNO DESC
    </select>
</mapper>
