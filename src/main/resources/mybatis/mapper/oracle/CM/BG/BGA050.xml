<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.korbiztech.product.cocs.CM.BG.dao.BGA050_DAO">

    <select id="selectSite" resultType="HashMap">
        SELECT A.SITE_CODE,
            '(' || A.SITE_CODE || ') ' || A.SITE_NAME AS SITE_NAME,
            A.SITE_COMMYN,
            MAX(INFO_CHSU) CFM_CHSU
        FROM TCT_SITE A, TBG_INFO B
        WHERE A.SITE_OFFICE = '01'
        AND A.SITE_USEYN = '1'
        AND B.INFO_COMP(+) = '1'
        AND A.SITE_OFFICE = B.INFO_OFFICE(+)
        AND A.SITE_CODE = B.INFO_SITE(+)
        AND SITE_CODE IN (
            SELECT AVBUJ_CD FROM SYTB0110
            WHERE USERS_ID = 'admin'
            AND GUNHA_EQ = '1'
            UNION ALL
            SELECT SITE_CODE FROM TCT_SITE
            WHERE EXISTS (SELECT 1 FROM SYTB0110
                WHERE USERS_ID = 'admin'
                AND GUNHA_EQ = '1'
                AND AVBUJ_CD = '*****')
            )
        GROUP BY A.SITE_CODE, A.SITE_NAME, A.SITE_COMMYN
    </select>

    <select id="selectChsu" parameterType="HashMap" resultType="HashMap">
        SELECT INFO_CHSU CHSU, INFO_CHSU || '차' CHASU, INFO_COMP COMP, INFO_APPFILE, INFO_FILEPATH
        FROM TBG_INFO
        WHERE INFO_OFFICE = '01'
        AND INFO_SITE = #{SITE_CODE}
        AND INFO_CHSU <![CDATA[ > ]]> 0
        ORDER BY CHSU DESC
    </select>

    <select id="selectGrid" parameterType="HashMap" resultType="HashMap">
        SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, ICODE, ISIZE, IUNIT, ILEVEL, SORT, SORT2, SILD_SEQ
        , PREVI, SILD_GUBU, SILD_GOGU, SILD_LGOJ, SILD_MGOJ
        , AMT1, AMT2, ROUND(AMT2 / DECODE(SILSUM, 0, NULL, SILSUM) * 100, 2) BOHAL, AMT3, AMT4, AMT5, AMT6, AMT7, AMT8, AMT9, INAME
        , DQTY, DPRI, SQTY, SPRI, SMPRI, SLPRI, SOMPRI, SOLPRI, SOAPRI, SEPRI, SAPRI
            FROM (
            SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, ' ' ICODE, NULL ISIZE, NULL IUNIT, 0 ILEVEL, ' ' SORT, ' ' SORT2, 0 SILD_SEQ
            , NULL PREVI, ' ' SILD_GUBU, NULL SILD_GOGU, NULL SILD_LGOJ, NULL SILD_MGOJ
            , SUM(SILD_DAMT) AMT1, SUM(SILD_SAMT) AMT2, SUM(SILD_SMAMT) AMT3, SUM(SILD_SLAMT) AMT4, SUM(SILD_SOMAMT) AMT5
            , SUM(SILD_SOLAMT) AMT6, SUM(SILD_SOAAMT) AMT7, SUM(SILD_SEAMT) AMT8, SUM(SILD_SAAMT) AMT9
            , '전체' INAME
            , 0 DQTY, 0 DPRI, 0 SQTY, 0 SPRI, 0 SMPRI, 0 SLPRI, 0 SOMPRI, 0 SOLPRI, 0 SOAPRI, 0 SEPRI, 0 SAPRI
            FROM TBG_SILD
            WHERE SILD_OFFICE = '01'
            AND SILD_SITE = #{SITE_CODE}
            AND SILD_CHSU = #{CHSU}
            GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU
        UNION ALL
        SELECT A.*, ' ' || B.GUBU_NAME INAME
        , 0 DQTY, 0 DPRI, 0 SQTY, 0 SPRI, 0 SMPRI, 0 SLPRI, 0 SOMPRI, 0 SOLPRI, 0 SOAPRI, 0 SEPRI, 0 SAPRI
        FROM (
            SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, SILD_GUBU ICODE, NULL ISIZE, NULL IUNIT, 1 ILEVEL, SILD_GUBU SORT, ' ' SORT2, 0 SILD_SEQ
            , ' ' PREVI, SILD_GUBU, NULL SILD_GOGU, NULL SILD_LGOJ, NULL SILD_MGOJ
            , SUM(SILD_DAMT) AMT1, SUM(SILD_SAMT) AMT2, SUM(SILD_SMAMT) AMT3, SUM(SILD_SLAMT) AMT4, SUM(SILD_SOMAMT) AMT5
            , SUM(SILD_SOLAMT) AMT6, SUM(SILD_SOAAMT) AMT7, SUM(SILD_SEAMT) AMT8, SUM(SILD_SAAMT) AMT9
            FROM TBG_SILD
            WHERE SILD_OFFICE = '01'
            AND SILD_SITE = #{SITE_CODE}
            AND SILD_CHSU = #{CHSU}
            GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU, SILD_GUBU
            ) A, TBG_GUBU B
            WHERE A.SILD_GUBU = B.GUBU_CODE
        UNION ALL
        SELECT A.*, '  ' || B.GOGU_NAME INAME
        , 0 DQTY, 0 DPRI, 0 SQTY, 0 SPRI, 0 SMPRI, 0 SLPRI, 0 SOMPRI, 0 SOLPRI, 0 SOAPRI, 0 SEPRI, 0 SAPRI
        FROM (
            SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, ' ' || SILD_GOGU ICODE, NULL ISIZE, NULL IUNIT, 2 ILEVEL, SILD_GUBU || SILD_GOGU SORT, ' ' SORT2, 0 SILD_SEQ
            , SILD_GUBU PREVI, NULL SILD_GUBU, SILD_GOGU, NULL SILD_LGOJ, NULL SILD_MGOJ
            , SUM(SILD_DAMT) AMT1, SUM(SILD_SAMT) AMT2, SUM(SILD_SMAMT) AMT3, SUM(SILD_SLAMT) AMT4, SUM(SILD_SOMAMT) AMT5
            , SUM(SILD_SOLAMT) AMT6, SUM(SILD_SOAAMT) AMT7, SUM(SILD_SEAMT) AMT8, SUM(SILD_SAAMT) AMT9
            FROM TBG_SILD
            WHERE SILD_OFFICE = '01'
            AND SILD_SITE = #{SITE_CODE}
            AND SILD_CHSU = #{CHSU}
            GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU, SILD_GUBU, SILD_GOGU
            ) A, TBG_GOGU B
            WHERE A.SILD_OFFICE = B.GOGU_OFFICE
            AND A.SILD_SITE = B.GOGU_SITE
            AND A.SILD_GOGU = B.GOGU_CODE
        UNION ALL
        SELECT A.*, '   ' || B.LGOJ_NAME INAME
        , 0 DQTY, 0 DPRI, 0 SQTY, 0 SPRI, 0 SMPRI, 0 SLPRI, 0 SOMPRI, 0 SOLPRI, 0 SOAPRI, 0 SEPRI, 0 SAPRI
        FROM (
            SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, '  ' || SILD_LGOJ ICODE, NULL ISIZE, NULL IUNIT, 3 ILEVEL, SILD_GUBU || SILD_GOGU || SILD_LGOJ SORT, ' ' SORT2, 0 SILD_SEQ
            , SILD_GUBU||SILD_GOGU PREVI, SILD_GUBU, NULL SILD_GOGU, SILD_LGOJ, NULL SILD_MGOJ
            , SUM(SILD_DAMT) AMT1, SUM(SILD_SAMT) AMT2, SUM(SILD_SMAMT) AMT3, SUM(SILD_SLAMT) AMT4, SUM(SILD_SOMAMT) AMT5
            , SUM(SILD_SOLAMT) AMT6, SUM(SILD_SOAAMT) AMT7, SUM(SILD_SEAMT) AMT8, SUM(SILD_SAAMT) AMT9
            FROM TBG_SILD
            WHERE SILD_OFFICE = '01'
            AND SILD_SITE = #{SITE_CODE}
            AND SILD_CHSU = #{CHSU}
            GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU, SILD_GUBU, SILD_GOGU, SILD_LGOJ
            ) A, TBG_LGOJ B
            WHERE A.SILD_GUBU = B.LGOJ_GUBU
            AND A.SILD_LGOJ = B.LGOJ_CODE
        UNION ALL
        SELECT A.*, '    ' || B.MGOJ_NAME INAME
        , 0 DQTY, 0 DPRI, 0 SQTY, 0 SPRI, 0 SMPRI, 0 SLPRI, 0 SOMPRI, 0 SOLPRI, 0 SOAPRI, 0 SEPRI, 0 SAPRI
        FROM (
            SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, '   ' || SILD_MGOJ ICODE, NULL ISIZE, NULL IUNIT, 4 ILEVEL, SILD_GUBU || SILD_GOGU || SILD_LGOJ || SILD_MGOJ SORT, ' ' SORT2, 0 SILD_SEQ
            , SILD_GUBU || SILD_GOGU || SILD_LGOJ PREVI, SILD_GUBU, SILD_GOGU, SILD_LGOJ, SILD_MGOJ
            , SUM(SILD_DAMT) AMT1, SUM(SILD_SAMT) AMT2, SUM(SILD_SMAMT) AMT3, SUM(SILD_SLAMT) AMT4, SUM(SILD_SOMAMT) AMT5
            , SUM(SILD_SOLAMT) AMT6, SUM(SILD_SOAAMT) AMT7, SUM(SILD_SEAMT) AMT8, SUM(SILD_SAAMT) AMT9
            FROM TBG_SILD
            WHERE SILD_OFFICE = '01'
            AND SILD_SITE = #{SITE_CODE}
            AND SILD_CHSU = #{CHSU}
            GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU, SILD_GUBU, SILD_GOGU, SILD_LGOJ, SILD_MGOJ
            ) A, TBG_MGOJ B
            WHERE A.SILD_GUBU = B.MGOJ_GUBU
            AND A.SILD_LGOJ = B.MGOJ_LGOJ
            AND A.SILD_MGOJ = B.MGOJ_CODE
        UNION ALL
        SELECT SILD_OFFICE, SILD_SITE, SILD_CHSU, '    ' || SILD_ITEM ICODE, SILD_SIZE ISIZE, SILD_UNIT IUNIT, 5 ILEVEL
        , SILD_GUBU || SILD_GOGU || SILD_LGOJ || SILD_MGOJ SORT, SILD_ITEM SORT2, DECODE(NVL(SILD_SEQ, 0), 0, 99999, SILD_SEQ) SILD_SEQ
        , SILD_GUBU || SILD_GOGU || SILD_LGOJ || SILD_MGOJ PREVI, SILD_GUBU, SILD_GOGU, SILD_LGOJ, SILD_MGOJ
        , SILD_DAMT AMT1, SILD_SAMT AMT2, SILD_SMAMT AMT3, SILD_SLAMT AMT4, SILD_SOMAMT AMT5
        , SILD_SOLAMT AMT6, SILD_SOAAMT AMT7, SILD_SEAMT AMT8, SILD_SAAMT AMT9, '     ' || SILD_NAME INAME
        , SILD_DQTY DQTY, SILD_DPRI DPRI, SILD_SQTY SQTY, SILD_SPRI SPRI, SILD_SMPRI SMPRI, SILD_SLPRI SLPRI, SILD_SOMPRI SOMPRI, SILD_SOLPRI SOLPRI, SILD_SOAPRI SOAPRI, SILD_SEPRI SEPRI, SILD_SAPRI SAPRI
        FROM TBG_SILD
        WHERE SILD_OFFICE = '01'
        AND SILD_SITE = #{SITE_CODE}
        AND SILD_CHSU = #{CHSU}
        ) A
        , (
        SELECT SUM(SILD_SAMT) SILSUM
        FROM TBG_SILD
        WHERE SILD_OFFICE = '01'
        AND SILD_SITE = #{SITE_CODE}
        AND SILD_CHSU = #{CHSU}
        GROUP BY SILD_OFFICE, SILD_SITE, SILD_CHSU
        ) B
        <if test = "SEQ_SORT == 1">
            ORDER BY SORT, SILD_SEQ, SORT2
        </if>
         <if test = "SEQ_SORT != 1">
            ORDER BY SORT, SORT2
        </if>
    </select>

    <select id="selectAmt" parameterType="HashMap" resultType="HashMap">
        SELECT SITE_DOAMT, SITE_SIAMT, SITE_DOYN
        FROM TCT_SITE
        WHERE SITE_OFFICE = '01'
        AND SITE_CODE = #{SITE_CODE}
    </select>

</mapper>